%----------------------------------------------------------------------------
\clearpage\section{Domain-specific Language}
%----------------------------------------------------------------------------

Like the Gamma Statechart Language, the Gamma Activity Language is intended to be a first-class citizen in the Gamma Framework, thus it must have a domain-specific language to represent in a textual way. This implementation draws highly from the SysMLv2\cite{omg_sysml_v2} language design, while also fitting into the already existing language family of Gamma (\autoref{sec:gamma}).

\subsection{Meta-model}

Due to the complexity of the final meta-model of the language, I have split it into multiple parts for easier understanding.

\subsubsection*{Root Structure}\label{ssec:root_structure}

Every model has to have a root element structure; Activity Language is not any different. The meta-model described in this section can be seen in \autoref{fig:declaration}.

\begin{figure}[!ht]
	\centering
	\includesvg[inkscapelatex=false, width=120mm, keepaspectratio]{declaration}
	\caption{The root structure of the language}
	\label{fig:declaration}
\end{figure}

\paragraph{Activity Declaration}\label{par:activity_declaration}

All elements inside an activity are contained in a root \emph{ActivityDeclaration} element. It contains \emph{Pins} needed for value passing (see \autoref{ssec:pins}) and a \emph{Definition}. A declaration can be \emph{InlineActivityDeclaration}, which means they are declared in an other declaration, or \emph{NamedActivityDeclaration}, which is a standalone activity declaration. The difference will be clarified in \autoref{ssec:composing_activities}.

\paragraph{Definition}\label{par:definition}

The definition \emph{defines} how the activity is described; using activity nodes, or by the Gamma Activity Language\footnote{Gamma Activity Language is a lightweight programming language-like construct for writing simple algorithms}. \emph{ActionDefinition} contains a single \emph{Block}\footnote{A \emph{Block} contains multiple \emph{Actions} which are executed one after the other}, which is executed as-is when the activity is executed\footnote{This fact means, that if one used Action to define an activity, that activity is executed atomically; it will not be interlaced with other XSTS transitions. See \autoref{ch:activiy_verification}.}. \emph{ActivityDefinition} contains \emph{ActivityNodes} (\autoref{ssec:activity_nodes}) and \emph{Flows} (\autoref{ssec:flows}).

\subsubsection*{Activity Nodes}\label{ssec:activity_nodes}

In the following, I will talk about the different kinds of \emph{ActivityNodes} and their special meanings. All nodes are considered \emph{LAS} nodes by default. The meta-model described in this section can be seen in \autoref{fig:activity_nodes}.

\begin{figure}[!ht]
	\centering
	\includesvg[inkscapelatex=false, width=120mm, keepaspectratio]{activity_nodes}
	\caption{The Activity Node structure}
	\label{fig:activity_nodes}
\end{figure}

\paragraph{Pseudo Activity Node}

\emph{PseudoActivityNodes} are nodes, that do not represent a specific action, however are needed to convey specific meanings, e.g., the initial active node, or a decision between flows.

\paragraph{Initial Node}

\emph{InitialNodes} have one token in them when the containing activity is started. They shall only have (one or more) outgoing flows, and no input flows. 

\paragraph{Final Node}

When an activities \emph{FinalNode} gets a token the containing activity is considered \emph{Done}; after which the activity does not process any more tokens.

\paragraph{Data Node}

\emph{DataNodes} encapsulate the meaning of \emph{data} inside activities. A token may contain data (or value) of any kind, but that token can only travel to and from data \emph{sources} and \emph{targets}. More about this in \autoref{par:data_flow}.

\paragraph{Fork Node}

\emph{ForkNodes} are used to model parallelism, by creating one token on each of its output flows when executed. Fork nodes shall only have one input flow.

\paragraph{Join Node}

\emph{JoinNodes} are the pair of fork nodes; the additional created tokens are swallowed by this node, by only sending out one token, regardless of the number of input flows.

\paragraph{Decision Node}

\emph{DecisionNodes} create branches across multiple output flows. An input flows token is removed, and sent out to one, and only one of its output flows - depending on which of the output flows are \emph{enabled} (see \autoref{ssec:flows}).

\paragraph{Merge Node}

\emph{MergeNodes} 

\subsubsection*{Composing Activities}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\begin{figure}[!ht]
	\centering
	\includesvg[inkscapelatex=false, width=90mm, keepaspectratio]{composite-activity}
	\caption{The }
	\label{fig:composite_activity}
\end{figure}

\subsubsection*{Flows}\label{ssec:flows}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\paragraph{Control Flow}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\paragraph{Data Flow}\label{par:data_flow}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\begin{figure}[!ht]
	\centering
	\includesvg[inkscapelatex=false, width=90mm, keepaspectratio]{flows}
	\caption{The Flows structure}
	\label{fig:flows}
\end{figure}

\subsubsection*{Pins}\label{ssec:pins}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\paragraph{Input Pin}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\paragraph{Output Pin}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\begin{figure}[!ht]
	\centering
	\includesvg[inkscapelatex=false, width=60mm, keepaspectratio]{pins}
	\caption{The Pins structure}
	\label{fig:pins}
\end{figure}

\subsubsection*{Data Source-Target Reference}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\begin{figure}[!ht]
	\centering
	\includesvg[inkscapelatex=false, width=110mm, keepaspectratio]{data-source-target}
	\caption{The Data node reference structure}
	\label{fig:data_source_target_reference}
\end{figure}

\subsubsection*{Pin Reference}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\begin{figure}[!ht]
	\centering
	\includesvg[inkscapelatex=false, width=110mm, keepaspectratio]{pin-reference}
	\caption{The Data node reference structure}
	\label{fig:pin_reference}
\end{figure}

\subsubsection*{Gamma Extension}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut vehicula turpis eget enim maximus, vel rutrum dui ullamcorper. Nulla enim ex, dapibus non aliquam vitae, molestie quis magna. Maecenas mattis turpis non ex feugiat, vitae pulvinar nisl vulputate.

\subsection{Xtext Language}

ide még jöhet később xtext kód

In order to make it easier to test both the XSTS and SysML transformations, I created an \textbf{Xtext} domain-specific language. Easy readability and writing was not one of the main priorities, because the end goal is to have a higher-level systems modelling language as a source. As a result, many many constructs are inherently repetitive to write.

\subsubsection*{Example}

The following is a basic example of an adder activity.
It 'reads' two numbers, adds them, and then 'logs' the result.

diagram, opaque action

Ehelyett egyébként lehetne a running example, amit még az egész elején definiálunk

\lstinputlisting{code/language/add-example.gcd}
